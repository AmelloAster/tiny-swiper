{"version":3,"file":"lazyload.js","sources":["../../src/lib.js","../../src/modules/lazyload.js"],"sourcesContent":["export function addClassName (el, list = []) {\n    if (!Array.isArray(list)) list = [list]\n\n    list.forEach(clz => (!el.classList.contains(clz) && el.classList.add(clz)))\n}\n\nexport function removeClassName (el, list = []) {\n    if (!Array.isArray(list)) list = [list]\n\n    list.forEach(clz => (el.classList.contains(clz) && el.classList.remove(clz)))\n}\n\nexport function detectTouch () {\n    return Boolean(\n        'ontouchstart' in window ||\n        window.navigator.maxTouchPoints > 0 ||\n        window.navigator.msMaxTouchPoints > 0 ||\n        window.DocumentTouch && document instanceof DocumentTouch\n    )\n}\n\n/**\n * get Element transform\n * @param {HTMLElement} el\n * @param {Boolean} isHorizontal\n * @returns {Number}\n */\nexport function getTranslate (el, isHorizontal) {\n    const matrix = getComputedStyle(el).transform.replace(/[a-z]|\\(|\\)|\\s/g, '').split(',').map(parseFloat)\n    let arr\n\n    if (matrix.length === 16) {\n        arr = matrix.slice(12, 14)\n    } else if (matrix.length === 6) {\n        arr = matrix.slice(4, 6)\n    }\n    return arr[isHorizontal ? 0 : 1] || 0\n}\n","import {\n    addClassName,\n    removeClassName\n} from '../lib.js'\n\n/**\n * TinySwiper plugin for image lazy loading.\n *\n * @param {*} tinyswiper\n */\nexport default function TinySwiperPluginLazyload (tinyswiper) {\n    const { config } = tinyswiper\n\n    if (!config.lazyload) return\n\n    tinyswiper.lazyload = {\n        load (index) {\n            const $slide = tinyswiper.$list[index]\n\n            if (!$slide) return\n\n            const $imgs = [].slice.call($slide.getElementsByClassName(config.lazyload.elementClass))\n            const $preloaders = [].slice.call($slide.getElementsByClassName(config.lazyload.preloaderClass))\n\n            function handleLoaded ($img) {\n                $img.removeAttribute('data-src')\n                addClassName($img, [ config.lazyload.loadedClass ])\n                removeClassName($img, [ config.lazyload.loadingClass ])\n                $img.onloaded = null\n                $img.onerror = null\n                $img.isLoaded = true\n\n                if ($imgs.every(item => item.isLoaded)) {\n                    $preloaders.forEach($preloader => {\n                        $preloader.parentElement.removeChild($preloader)\n                    })\n                }\n            }\n\n            $imgs.forEach($img => {\n                if (!$img.hasAttribute('data-src')) return\n\n                const src = $img.getAttribute('data-src')\n\n                addClassName($img, [ config.lazyload.loadingClass ])\n                removeClassName($img, [ config.lazyload.loadedClass ])\n                $img.src = src\n                $img.onload = () => handleLoaded($img)\n                $img.onerror = () => handleLoaded($img)\n            })\n        },\n\n        loadRange (index, range) {\n            tinyswiper.lazyload.load(index)\n\n            if (config.lazyload.loadPrevNext && range >= 1) {\n                for (let i = 1; i <= range; i++) {\n                    tinyswiper.lazyload.load(index + i)\n                    tinyswiper.lazyload.load(index - i)\n                }\n            }\n        }\n    }\n\n    tinyswiper.on('before-init', () => {\n        config.lazyload = {\n            loadPrevNext: false,\n            loadPrevNextAmount: 1,\n            loadOnTransitionStart: false,\n            elementClass: 'swiper-lazy',\n            loadingClass: 'swiper-lazy-loading',\n            loadedClass: 'swiper-lazy-loaded',\n            preloaderClass: 'swiper-lazy-preloader',\n            ...config.lazyload\n        }\n    })\n\n    if (config.lazyload.loadOnTransitionStart) {\n        tinyswiper.on('before-slide', function (oldIndex, instance, newIndex) {\n            tinyswiper.lazyload.loadRange(newIndex, config.lazyload.loadPrevNextAmount)\n        })\n    } else {\n        tinyswiper.on('after-slide', function (index, instance) {\n            tinyswiper.lazyload.loadRange(index, config.lazyload.loadPrevNextAmount)\n        })\n    }\n\n    tinyswiper.on('after-destroy', tinyswiper => {\n        const { config } = tinyswiper\n\n        if (!config.lazyload) return\n        delete tinyswiper.lazyload\n    })\n}\n"],"names":["addClassName","el","list","Array","isArray","forEach","clz","classList","contains","add","removeClassName","remove","TinySwiperPluginLazyload","tinyswiper","config","lazyload","load","index","$slide","$list","$imgs","slice","call","getElementsByClassName","elementClass","$preloaders","preloaderClass","handleLoaded","$img","removeAttribute","loadedClass","loadingClass","onloaded","onerror","isLoaded","every","item","$preloader","parentElement","removeChild","hasAttribute","src","getAttribute","onload","loadRange","range","loadPrevNext","i","on","loadPrevNextAmount","loadOnTransitionStart","oldIndex","instance","newIndex"],"mappings":"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"}