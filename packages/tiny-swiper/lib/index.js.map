{"version":3,"file":"index.js","sources":["../src/core/options.ts","../src/core/eventHub.ts","../src/core/state/trace.ts","../src/core/state/index.ts","../src/core/render/dom.ts","../src/core/render/nextTick.ts","../src/core/render/animation.ts","../src/core/sensor/motions.ts","../src/core/sensor/index.ts","../src/core/env/element.ts","../src/core/env/measure.ts","../src/core/env/limitation.ts","../src/core/env/index.ts","../src/core/render/index.ts","../src/core/state/operations.ts","../src/core/injections.ts","../src/core/index.ts"],"sourcesContent":["import { SwiperPlugin } from './index'\n\nexport type Direction = 'horizontal' | 'vertical'\n\nexport type Options = {\n    direction: Direction\n    touchRatio: number\n    touchAngle: number\n    longSwipesRatio: number\n    initialSlide: number\n    loop: boolean\n    freeMode: boolean\n    mousewheel: boolean\n    pagination: boolean\n    passiveListeners: boolean\n    resistance: boolean\n    resistanceRatio: number\n    speed: number\n    longSwipesMs: number\n    intermittent: number\n    spaceBetween: number\n    slidesPerView: number\n    centeredSlides: boolean\n    slidePrevClass: string\n    slideNextClass: string\n    slideActiveClass: string\n    slideClass: string\n    wrapperClass: string\n    touchStartPreventDefault: boolean\n    touchStartForcePreventDefault: boolean\n    touchMoveStopPropagation: boolean\n    excludeElements: Array<HTMLElement | string>\n    isHorizontal: boolean\n    plugins?: Array<SwiperPlugin>\n}\n\nexport type UserOptions = Partial<Options>\n\nconst defaultOptions: UserOptions = {\n    // `isHorizontal` is computed value\n    direction: 'horizontal',\n    touchRatio: 1,\n    touchAngle: 45,\n    longSwipesRatio: 0.5,\n    initialSlide: 0,\n    loop: false,\n    freeMode: false,\n    mousewheel: false,\n    pagination: false,\n    passiveListeners: true,\n    resistance: true,\n    resistanceRatio: 0.85,\n    speed: 300,\n    longSwipesMs: 300,\n    intermittent: 0,\n    spaceBetween: 0,\n    slidesPerView: 1,\n    centeredSlides: false,\n    slidePrevClass: 'swiper-slide-prev',\n    slideNextClass: 'swiper-slide-next',\n    slideActiveClass: 'swiper-slide-active',\n    slideClass: 'swiper-slide',\n    wrapperClass: 'swiper-wrapper',\n    touchStartPreventDefault: true,\n    touchStartForcePreventDefault: false,\n    touchMoveStopPropagation: false,\n    excludeElements: []\n}\n\nexport function optionFormatter (userOptions: UserOptions): Options {\n    const options = <Options>{\n        ...defaultOptions,\n        ...userOptions\n    }\n\n    return {\n        ...options,\n        isHorizontal: options.direction === 'horizontal'\n    }\n}\n","\nexport type EventHub = {\n    on (evtName: string, cb: Function): void\n    off (evtName: string, cb: Function): void\n    emit (evtName: string, ...data: Array<any>): void\n    clear (): void\n}\n\nexport function EventHub (): EventHub {\n    let hub: {\n        [key: string]: Array<Function>\n    } = {}\n\n    function on (evtName: string, cb: Function): void {\n        if (!hub[evtName]) {\n            hub[evtName] = [cb]\n        } else {\n            hub[evtName].push(cb)\n        }\n    }\n\n    function off (evtName: string, cb: Function): void {\n        if (hub[evtName]) {\n            const index = hub[evtName].indexOf(cb)\n\n            // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n            index > -1 && hub[evtName].splice(index, 1)\n        }\n    }\n\n    function emit (evtName: string, ...data: Array<any>): void {\n        if (hub[evtName]) {\n            hub[evtName].forEach(cb => cb(...data))\n        }\n    }\n\n    function clear (): void {\n        hub = {}\n    }\n\n    return {\n        on,\n        off,\n        emit,\n        clear\n    }\n}\n","const delta = 180 / Math.PI\n\nexport type TraceLogs = Array<Trace>\n\nexport type Offset = {\n    /**\n     * offset x\n     */\n    x: number\n\n    /**\n     * offset y\n     */\n    y: number\n}\n\nexport type Position = {\n    /**\n     * postion in the x-axis\n     */\n    x: number\n\n    /**\n     * postion in the y-axis\n     */\n    y: number\n}\n\nexport type Trace = {\n    /**\n     * timestamp of current postion\n     */\n    time: number\n} & Position\n\nexport type Tracker = {\n    push (postion: Position): void\n    vector (): Vector\n    clear (): void\n    getLogs (): TraceLogs\n    getDuration (): number\n    getOffset (): Offset\n}\n\nexport type Vector = {\n    /**\n     * offset in the x-axis\n     */\n    x: number\n\n    /**\n     * offset in the y-axis\n     */\n    y: number\n\n    /**\n     * velocity in the x-axis\n     */\n    velocityX: number\n\n    /**\n     * velocity in the y-axis\n     */\n    velocityY: number\n\n    /**\n     * direction angle\n     */\n    angle: number\n}\n\nexport function Vector (\n    logs: TraceLogs,\n    index: number\n): Vector {\n    const trace = logs[index]\n    const formerTrace = logs[index - 1]\n    const diff = {\n        x: trace.x - formerTrace.x,\n        y: trace.y - formerTrace.y\n    }\n    const duration = trace.time - formerTrace.time\n    const velocityX = diff.x / duration\n    const velocityY = diff.y / duration\n    const angle = Math.atan2(Math.abs(diff.y), Math.abs(diff.x)) * delta\n\n    return {\n        ...diff,\n        angle,\n        velocityX,\n        velocityY\n    }\n}\n\n\nexport function Tracker (): Tracker {\n    let logs: TraceLogs = []\n\n    function push (position: Position): void {\n        logs.push({\n            ...position,\n            time: Date.now()\n        })\n    }\n\n    function vector (): Vector {\n        return Vector(logs, logs.length - 1)\n    }\n\n    function clear () {\n        logs = []\n    }\n\n    function getLogs () {\n        return logs\n    }\n\n    function getDuration (): number {\n        const first = logs[0]\n        const last = logs[logs.length - 1]\n\n        return first ? last.time - first.time : 0\n    }\n\n    function getOffset (): Offset {\n        const first = logs[0]\n        const last = logs[logs.length - 1]\n\n        return first ? {\n            x: last.x - first.x,\n            y: last.y - first.y\n        } : {\n            x: 0,\n            y: 0\n        }\n    }\n\n    return {\n        getDuration,\n        getOffset,\n        getLogs,\n        vector,\n        clear,\n        push\n    }\n}\n","import { Tracker } from './trace'\n\nexport interface State {\n    tracker: Tracker\n    index: number\n    startTransform: number\n    isStart: boolean\n    isScrolling: boolean\n    isTouching: boolean\n    transforms: number\n    progress: number\n}\n\nexport function State (): State {\n    const state: State = {\n        tracker: Tracker(),\n        index: 0,\n        startTransform: 0,\n        isStart: false,\n        isScrolling: false,\n        isTouching: false,\n        transforms: 0,\n        progress: 0\n    }\n\n    return state\n}\n","export function addClass (\n    el: HTMLElement,\n    list: Array<string> | string = []\n): void {\n    if (!Array.isArray(list)) list = [list]\n\n    list.forEach(clz => (!el.classList.contains(clz) && el.classList.add(clz)))\n}\n\nexport function removeClass (\n    el: HTMLElement,\n    list: Array<string> | string = []\n): void {\n    if (!Array.isArray(list)) list = [list]\n\n    list.forEach(clz => (el.classList.contains(clz) && el.classList.remove(clz)))\n}\n\nexport function attachListener (\n    el: HTMLElement | Document,\n    evtName: string,\n    handler: EventListenerOrEventListenerObject,\n    opts?: boolean | AddEventListenerOptions\n): void {\n    el.addEventListener(evtName, handler, opts)\n}\n\nexport function detachListener (\n    el: HTMLElement | Document,\n    evtName: string,\n    handler: EventListenerOrEventListenerObject\n): void {\n    el.removeEventListener(evtName, handler)\n}\n\nexport function removeAttr (\n    el: HTMLElement,\n    attr: string\n): void {\n    el.removeAttribute(attr)\n}\n\nexport function setAttr (\n    el: HTMLElement,\n    attr: string,\n    value = ''\n): HTMLElement {\n    el.setAttribute(attr, value)\n    return el\n}\n\nexport function setStyle (\n    el: HTMLElement,\n    style: {[key: string]: string},\n    forceRender?: boolean\n): HTMLElement {\n    Object.keys(style).forEach(prop => {\n        // TS7015: Element implicitly has an 'any' type because index expression is not of type 'number'.\n        el.style[prop as any] = style[prop]\n    })\n    // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n    forceRender && getComputedStyle(el)\n\n    return el\n}\n\nexport function getTranslate (\n    el: HTMLElement,\n    isHorizontal: boolean\n): number {\n    const matrix = getComputedStyle(el).transform.replace(/[a-z]|\\(|\\)|\\s/g, '').split(',').map(parseFloat)\n    let arr: Array<number> = []\n\n    if (matrix.length === 16) {\n        arr = matrix.slice(12, 14)\n    } else if (matrix.length === 6) {\n        arr = matrix.slice(4, 6)\n    }\n    return (<Array<number>>arr)[isHorizontal ? 0 : 1] || 0\n}\n","function now () {\n    return performance ? performance.now() : Date.now()\n}\n\nexport type Tick = {\n    run (cb: (interval: DOMHighResTimeStamp) => void): void\n    stop (): void\n}\n\nexport function Tick (): Tick {\n    const nextFrame = requestAnimationFrame || webkitRequestAnimationFrame || setTimeout\n    const cancelNextFrame = cancelAnimationFrame || webkitCancelAnimationFrame || clearTimeout\n\n    let startTime: number | undefined\n    let id: number\n\n    function run (cb: (interval: DOMHighResTimeStamp) => void): void {\n        // eslint-disable-next-line no-void\n        startTime = startTime === void 0\n            ? now()\n            : startTime\n\n        // Why do not use callback argument:\n        // https://stackoverflow.com/questions/50895206/exact-time-of-display-requestanimationframe-usage-and-timeline\n        id = nextFrame(() => {\n            const timeStamp = now()\n            const interval = timeStamp - <number>startTime\n\n            startTime = timeStamp\n            cb(interval)\n        })\n    }\n\n    function stop (): void {\n        startTime = undefined\n        cancelNextFrame(id)\n    }\n\n    return {\n        run,\n        stop\n    }\n}\n","import { Tick } from './nextTick'\n\nexport type Animation = {\n    run (task: (interval: DOMHighResTimeStamp) => void): void\n    stop (): void\n}\n\nexport function Animation (): Animation {\n    const tick = Tick()\n\n    function run (task: (interval: DOMHighResTimeStamp) => void): void {\n        tick.run((interval: DOMHighResTimeStamp) => {\n            run(task)\n            task(interval)\n        })\n    }\n\n    function stop (): void {\n        tick.stop()\n    }\n\n    return {\n        run,\n        stop\n    }\n}\n","import { Position } from '../state/trace'\nimport { Options } from '../options'\nimport { Env } from '../env/index'\nimport { State } from '../state/index'\nimport { Operations } from '../state/operations'\nimport { Animation } from '../render/animation'\n\nexport type Motions = {\n    preheat (\n        originPosition: Position,\n        originTransform: number\n    ): void\n    move (position: Position): void\n    stop (): void\n}\n\nexport function Motions (\n    options: Options,\n    env: Env,\n    state: State,\n    operations: Operations\n) {\n    const {\n        initLayout,\n        initStatus,\n        render,\n        scrollPixel,\n        slideTo,\n        getOffsetSteps\n    } = operations\n    const animation = Animation()\n\n    function preheat (\n        originPosition: Position,\n        originTransform: number\n    ): void {\n        const { tracker } = state\n\n        animation.stop()\n        tracker.clear()\n        tracker.push(originPosition)\n        initLayout(originTransform)\n        initStatus(originTransform)\n        state.isStart = true\n\n        render()\n    }\n\n    function move (position: Position): void {\n        const {\n            tracker\n        } = state\n        const {\n            touchRatio,\n            touchAngle,\n            isHorizontal\n        } = options\n\n        if (!state.isStart || state.isScrolling) return\n\n        tracker.push(position)\n\n        const vector = tracker.vector()\n        const displacement = tracker.getOffset()\n\n        // Ignore this move action if there is no displacement of screen touch point.\n        // In case of minimal mouse move event. (Moving mouse extreme slowly will get the zero offset.)\n        if (!displacement.x && !displacement.y) return\n\n        if ((isHorizontal && (vector.angle < touchAngle))\n            || (!isHorizontal && (90 - vector.angle) < touchAngle)\n            || state.isTouching\n        ) {\n            const offset = vector[isHorizontal ? 'x' : 'y'] * touchRatio\n\n            state.isTouching = true\n            scrollPixel(offset)\n            render()\n        } else {\n            state.isScrolling = true\n            tracker.clear()\n        }\n    }\n\n    function stop (): void {\n        const {\n            index,\n            tracker\n        } = state\n        const {\n            measure\n        } = env\n\n        if (!options.freeMode || tracker.getLogs().length < 2) {\n            const duration = tracker.getDuration()\n            const trans = tracker.getOffset()[options.isHorizontal ? 'x' : 'y']\n            const jump = Math.ceil(Math.abs(trans) / measure.boxSize)\n            const longSwipeIndex = getOffsetSteps(trans)\n\n            if (duration > options.longSwipesMs) {\n                slideTo(index + longSwipeIndex * (trans > 0 ? -1 : 1))\n            } else {\n                // short swipe\n                slideTo(trans > 0 ? index - jump : index + jump)\n            }\n\n            tracker.clear()\n            initStatus()\n        } else {\n            const vector = tracker.vector()\n\n            let velocity = vector[options.isHorizontal ? 'velocityX' : 'velocityY']\n\n            // console.log(tracker.getLogs())\n            animation.run((duration: number) => {\n                const offset = velocity * duration\n\n                velocity *= 0.98\n\n                if (Math.abs(offset) < 0.004) {\n                    animation.stop()\n                    tracker.clear()\n                    initStatus()\n                } else {\n                    scrollPixel(offset)\n                    render(0)\n                }\n            })\n        }\n    }\n\n    return {\n        preheat,\n        move,\n        stop\n    }\n}\n","import { State } from '../state/index'\nimport { Env } from '../env/index'\nimport { attachListener, detachListener, getTranslate } from '../render/dom'\nimport { Options } from '../options'\nimport { Position } from '../state/trace'\nimport { Motions } from './motions'\nimport { Operations } from '../state/operations'\nimport { Injections } from '../injections'\n\nexport type Sensor = {\n    attach: () => void\n    detach: () => void\n}\n\n// Only support single finger touch event.\nexport function Sensor (\n    env: Env,\n    state: State,\n    options: Options,\n    operations: Operations,\n    injections: Injections\n): Sensor {\n    const {\n        touchable\n    } = env\n    const formEls = [\n        'INPUT',\n        'SELECT',\n        'OPTION',\n        'TEXTAREA',\n        'BUTTON',\n        'VIDEO'\n    ]\n    const motions = injections.get('Motions', Motions)(options, env, state, operations)\n    const {\n        preheat,\n        move,\n        stop\n    } = motions\n\n\n    function getPosition (e: Event): Position {\n        const touch = touchable ? (<TouchEvent>e).changedTouches[0] : <MouseEvent>e\n\n        return {\n            x: touch.pageX,\n            y: touch.pageY\n        }\n    }\n\n    function onTouchStart (e: Event): void {\n        const {\n            $wrapper\n        } = env.element\n        const shouldPreventDefault = (options.touchStartPreventDefault && formEls.indexOf((<HTMLElement>e.target).nodeName) === -1)\n            || options.touchStartForcePreventDefault\n\n        if (shouldPreventDefault && !options.passiveListeners) e.preventDefault()\n\n        preheat(\n            getPosition(e),\n            getTranslate($wrapper, options.isHorizontal)\n        )\n    }\n\n    function onTouchMove (e: Event): void {\n        if (options.touchMoveStopPropagation) e.stopPropagation()\n\n        move(getPosition(e))\n        state.isTouching && e.preventDefault()\n    }\n\n    function onTouchEnd (): void {\n        stop()\n    }\n\n    function attach (): void {\n        const {\n            $el\n        } = env.element\n\n        if (touchable) {\n            attachListener($el, 'touchstart', onTouchStart, {\n                passive: options.passiveListeners,\n                capture: false\n            })\n            attachListener($el, 'touchmove', onTouchMove)\n            attachListener($el, 'touchend', onTouchEnd)\n            attachListener($el, 'touchcancel', onTouchEnd)\n        } else {\n            attachListener($el, 'mousedown', onTouchStart)\n            attachListener(document, 'mousemove', onTouchMove)\n            attachListener(document, 'mouseup', onTouchEnd)\n        }\n    }\n\n    function detach (): void {\n        const {\n            $el\n        } = env.element\n\n        detachListener($el, 'touchstart', onTouchStart)\n        detachListener($el, 'touchmove', onTouchMove)\n        detachListener($el, 'touchend', onTouchEnd)\n        detachListener($el, 'touchcancel', onTouchEnd)\n        detachListener($el, 'mousedown', onTouchStart)\n        detachListener(document, 'mousemove', onTouchMove)\n        detachListener(document, 'mouseup', onTouchEnd)\n    }\n\n    return {\n        attach,\n        detach\n    }\n}\n","import { Options } from '../options'\n\nexport type Element = {\n    $el: HTMLElement\n    $list: Array<HTMLElement>\n    $wrapper: HTMLElement\n}\n\nexport function Element (\n    el: HTMLElement | string,\n    options: Options\n): Element {\n    const $el = <HTMLElement>(typeof el === 'string' ? document.body.querySelector(el) : el)\n    const $wrapper = <HTMLElement>$el!.querySelector(`.${options.wrapperClass}`)\n    const $list = [].slice.call($el!.getElementsByClassName(options.slideClass))\n\n    return {\n        $el,\n        $wrapper,\n        $list\n    }\n}\n","import { Options } from '../options'\nimport { Element } from './element'\n\nexport type Measure = {\n    boxSize: number\n    viewSize: number\n    slideSize: number\n}\n\nexport function Measure (\n    options: Options,\n    element: Element\n): Measure {\n    const {\n        $el\n    } = element\n    const viewSize = options.isHorizontal ? $el.offsetWidth : $el.offsetHeight\n    const slideSize = (viewSize - (Math.ceil(options.slidesPerView - 1)) * options.spaceBetween) / options.slidesPerView\n    const boxSize = slideSize + options.spaceBetween\n\n    return {\n        boxSize,\n        viewSize,\n        slideSize\n    }\n}\n","import { Options } from '../options'\nimport { Element } from './element'\nimport { Measure } from './measure'\n\nexport type Limitation = {\n    min: number\n    max: number\n    base: number\n    expand: number\n    buffer: number\n    minIndex: number\n    maxIndex: number\n}\n\nexport function getExpand (\n    options: Options,\n    element: Element\n): number {\n    if (options.loop) {\n        // return options.slidesPerView >= element.$list.length\n        //     ? options.slidesPerView - element.$list.length + 1\n        //     : 1\n        return Math.ceil(options.slidesPerView)\n    }\n    return 0\n}\n\nexport function Limitation (\n    element: Element,\n    measure: Measure,\n    options: Options\n): Limitation {\n    const {\n        $list\n    } = element\n    const {\n        viewSize,\n        slideSize,\n        boxSize\n    } = measure\n    const expand = getExpand(options, element)\n    const buffer = expand * boxSize\n    const base = -buffer + (options.centeredSlides\n        ? (viewSize - slideSize) / 2\n        : 0)\n    // [min, max] usually equal to [-x, 0]\n    const max = base\n    const min = options.spaceBetween + (options.loop ? slideSize : viewSize) + base - boxSize * $list.length\n    const minIndex = 0\n    const maxIndex = $list.length - ((options.centeredSlides || options.loop)\n        ? 1\n        : Math.ceil(options.slidesPerView))\n\n    const limitation = {\n        max,\n        min,\n        base,\n        expand,\n        buffer,\n        minIndex,\n        maxIndex\n    }\n\n    return limitation\n}\n","import { Options } from '../options'\nimport { Element } from './element'\nimport { Measure } from './measure'\nimport { Limitation } from './limitation'\n\ndeclare global {\n    interface Window {\n        DocumentTouch: any\n    }\n    const DocumentTouch: any\n}\n\nexport type Env = {\n    touchable: boolean\n    element: Element\n    measure: Measure\n    limitation: Limitation\n    update (): void\n}\n\nexport function Env (\n    el: HTMLElement | string,\n    options: Options\n): Env {\n    const env = <Env>{}\n\n    function update (): void {\n        const element = Element(\n            el,\n            options\n        )\n        const measure = Measure(\n            options,\n            element\n        )\n        const limitation = Limitation(\n            element,\n            measure,\n            options\n        )\n        const touchable = Boolean(\n            'ontouchstart' in window\n            || navigator.maxTouchPoints > 0\n            || navigator.msMaxTouchPoints > 0\n            || window.DocumentTouch && document instanceof DocumentTouch\n        )\n\n        Object.assign(env, {\n            touchable,\n            element,\n            measure,\n            limitation\n        })\n    }\n\n    env.update = update\n\n    update()\n\n    return env\n}\n","import { Options } from '../options'\nimport {\n    removeClass, addClass, setStyle, setAttr\n} from './dom'\nimport { State } from '../state/index'\nimport { Env } from '../env/index'\n\nconst shallowTag = 'data-shallow-slider'\nconst sliderTag = 'data-slider'\n\nexport type Renderer = {\n    init (): void\n    render (\n        state: State,\n        duration?: number,\n        cb?: Function,\n        force?: boolean\n    ): void\n    destroy (): void\n    updateSize (): void\n}\n\nexport function Renderer (\n    env: Env,\n    options: Options\n): Renderer {\n    function render (\n        state: State,\n        duration?: number,\n        cb?: Function,\n        force?: false\n    ) {\n        const {\n            $wrapper\n        } = env.element\n        const {\n            index\n        } = state\n        const wrapperStyle = {\n            transition: state.isStart\n                ? 'none'\n                : `transform ease ${duration === undefined ? options.speed : duration}ms`,\n            transform: options.isHorizontal\n                ? `translate3d(${state.transforms}px, 0, 0)`\n                : `translate3d(0, ${state.transforms}px, 0)`\n        }\n\n        setStyle($wrapper, wrapperStyle)\n\n        if (!state.isStart) {\n            $wrapper.querySelectorAll(`[${sliderTag}]`).forEach($slide => {\n                // eslint-disable-next-line no-bitwise\n                const tagNumber = ~~<string>$slide.getAttribute(sliderTag)\n\n                removeClass(<HTMLElement>$slide, [\n                    options.slidePrevClass,\n                    options.slideNextClass,\n                    options.slideActiveClass\n                ])\n\n                if (tagNumber === index) {\n                    addClass(<HTMLElement>$slide, options.slideActiveClass)\n                }\n                if (tagNumber === index - 1) {\n                    addClass(<HTMLElement>$slide, options.slidePrevClass)\n                }\n                if (tagNumber === index + 1) {\n                    addClass(<HTMLElement>$slide, options.slideNextClass)\n                }\n            })\n        }\n\n        force && getComputedStyle($wrapper).transform\n    }\n\n    function appendExpandList (): void {\n        if (!options.loop) return\n\n        const {\n            element,\n            limitation\n        } = env\n        const {\n            $list,\n            $wrapper\n        } = element\n        const {\n            expand\n        } = limitation\n        const $leftExpandList = $list.slice(-expand)\n            .map($slide => <HTMLElement>$slide.cloneNode(true))\n        const $rightExpandList = $list.slice(0, expand)\n            .map($slide => <HTMLElement>$slide.cloneNode(true))\n\n        $leftExpandList.forEach(($shadowSlide, index) => {\n            $wrapper.appendChild(setAttr($rightExpandList[index], shallowTag))\n            $wrapper.insertBefore(setAttr($leftExpandList[index], shallowTag), $list[0])\n        })\n    }\n\n    function destroyExpandList (): void {\n        env.element.$wrapper\n            .querySelectorAll(`[${shallowTag}]`)\n            .forEach(item => env.element.$wrapper.removeChild(item))\n    }\n\n    function updateDom (): void {\n        env.element.$list.forEach((el, index) => setAttr(el, sliderTag, <any>index))\n\n        destroyExpandList()\n        appendExpandList()\n    }\n\n    function updateSize (): void {\n        const {\n            element,\n            measure\n        } = env\n        const {\n            $wrapper\n        } = element\n        const wrapperStyle = {\n            display: 'flex',\n            willChange: 'transform',\n            flexDirection: options.isHorizontal ? 'row' : 'column'\n        }\n        const itemStyle = {\n            [options.isHorizontal ? 'width' : 'height']: `${measure.slideSize}px`,\n            [options.isHorizontal ? 'margin-right' : 'margin-bottom']: `${options.spaceBetween}px`\n        }\n\n        setStyle($wrapper, wrapperStyle)\n        $wrapper.querySelectorAll(`[${sliderTag}]`)\n            .forEach($slide => setStyle(<HTMLElement>$slide, itemStyle))\n    }\n\n    function init (): void {\n        updateDom()\n        updateSize()\n    }\n\n    function destroy (): void {\n        const {\n            $list,\n            $wrapper\n        } = env.element\n        const arr = ['display', 'will-change', 'flex-direction']\n        const itemProp = options.isHorizontal ? 'margin-right' : 'margin-bottom'\n\n        arr.forEach((propertyName: string) => {\n            $wrapper.style.removeProperty(propertyName)\n        })\n        $list.forEach($slide => $slide.style.removeProperty(itemProp))\n        destroyExpandList()\n    }\n\n    return {\n        init,\n        render,\n        destroy,\n        updateSize\n    }\n}\n","import { Position } from './trace'\nimport { State } from './index'\nimport { Limitation } from '../env/limitation'\nimport { EventHub } from '../eventHub'\nimport { Renderer } from '../render/index'\nimport { Options } from '../options'\nimport { Env } from '../env/index'\n\nexport interface Operations {\n    update (): void\n    render (duration?: number): void\n    transform (trans: number): void\n    slideTo (\n        targetIndex: number,\n        duration?: number\n    ): void\n    scrollPixel (px: number): void\n    initStatus (startTransform?: number): void\n    initLayout (originTransform: number): void\n    getOffsetSteps (offset: number): number\n}\n\nexport function isExceedingLimits (\n    velocity: number,\n    transform: number,\n    options: Options,\n    limitation: Limitation\n): boolean {\n    return velocity > 0 && transform > (limitation.max)\n        || velocity < 0 && transform < (limitation.min)\n}\n\n\n/**\n * Get transform exceed value\n * Return zero if is not reached border.\n *\n * @param transform\n * @param options\n * @param limitation\n */\nexport function getExcess (\n    transform: number,\n    options: Options,\n    limitation: Limitation\n): number {\n    const exceedLeft = transform - limitation.max\n    const exceedRight = transform - limitation.min\n\n    return exceedLeft > 0\n        ? exceedLeft\n        : exceedRight < 0\n            ? exceedRight\n            : 0\n}\n\nexport function Operations (\n    env: Env,\n    state: State,\n    options: Options,\n    renderer: Renderer,\n    eventHub: EventHub\n): Operations {\n    function getOffsetSteps (offset: number): number {\n        const {\n            measure\n        } = env\n        return Math.ceil(Math.abs(offset) / measure.boxSize - options.longSwipesRatio)\n    }\n\n    function render (\n        duration?: number,\n        cb?: Function,\n        force?: boolean\n    ): void {\n        renderer.render(\n            state,\n            duration,\n            cb,\n            force\n        )\n    }\n\n    function transform (trans: number): void {\n        const {\n            min,\n            max\n        } = env.limitation\n        const transRange = max - min + (options.loop ? env.measure.boxSize : 0)\n        const len = transRange + 1\n\n        let progress\n\n        state.transforms = trans\n\n        if (options.loop) {\n            progress = (max - trans) % len / transRange\n\n            state.progress = progress < 0\n                ? 1 + progress\n                : progress > 1\n                    ? progress - 1\n                    : progress\n        } else {\n            progress = (max - trans) / transRange\n\n            state.progress = progress < 0\n                ? 0\n                : progress > 1\n                    ? 1\n                    : progress\n        }\n\n        eventHub.emit('scroll', {\n            ...state\n        })\n    }\n\n    function slideTo (\n        targetIndex: number,\n        duration?: number\n    ): void {\n        const {\n            measure,\n            limitation\n        } = env\n        const len = limitation.maxIndex - limitation.minIndex + 1\n        const computedIndex = options.loop\n            ? (targetIndex % len + len) % len\n            : targetIndex > limitation.maxIndex\n                ? limitation.maxIndex\n                : targetIndex < limitation.minIndex\n                    ? limitation.minIndex\n                    : targetIndex\n        const offset = -computedIndex * measure.boxSize + limitation.base\n\n        // Slide over a cycle.\n        if (state.index === computedIndex\n            && getOffsetSteps(offset - state.transforms) !== 0\n        ) {\n            const excess = getExcess(state.transforms, options, limitation)\n\n            transform(excess > 0\n                ? limitation.min - measure.boxSize + excess\n                : limitation.max + measure.boxSize + excess)\n\n            // Set initial offset for rebounding animation.\n            render(0, undefined, true)\n        }\n\n        state.index = computedIndex\n        transform(offset)\n        eventHub.emit('before-slide',\n            targetIndex,\n            state)\n        render(duration)\n    }\n\n    function scrollPixel (px: number): void {\n        const {\n            transforms\n        } = state\n        const {\n            measure,\n            limitation\n        } = env\n        const ratio = Number(px.toExponential().split('e')[1])\n        const expand = ratio <= 0 ? Math.pow(10, -(ratio - 1)) : 1\n\n        let newTransform = transforms\n\n        // For optimizing, do not calculate `px` if options.loop === true\n        if (options.resistance && !options.loop) {\n            if (px > 0 && transforms >= limitation.max) {\n                px -= (px * expand) ** options.resistanceRatio / expand\n            } else if (px < 0 && transforms <= limitation.min) {\n                px += ((-px * expand) ** options.resistanceRatio) / expand\n            }\n        }\n\n        newTransform += px\n\n        if (options.loop) {\n            const vector = state.tracker.vector()\n            const velocity = options.isHorizontal ? vector.velocityX : vector.velocityY\n            const excess = getExcess(transforms, options, limitation)\n\n            if (excess && isExceedingLimits(\n                velocity,\n                transforms,\n                options,\n                limitation\n            )) {\n                newTransform = excess > 0\n                    ? limitation.min - measure.boxSize + excess\n                    : limitation.max + measure.boxSize + excess\n            }\n        }\n\n        transform(newTransform)\n    }\n\n    function initStatus (startTransform = 0): void {\n        state.startTransform = startTransform\n        state.isStart = false\n        state.isScrolling = false\n        state.isTouching = false\n    }\n\n    function initLayout (originTransform: number): void {\n        transform(originTransform)\n    }\n\n    function update (): void {\n        slideTo(state.index, 0)\n        renderer.updateSize()\n    }\n\n    return {\n        update,\n        render,\n        transform,\n        slideTo,\n        scrollPixel,\n        initStatus,\n        initLayout,\n        getOffsetSteps\n    }\n}\n","export type Injections = {\n    inject (key: string, injection: Function): void\n    get (key: string, backup: Function): Function\n}\n\nexport function Injections (): Injections {\n    const injections: any = {}\n\n    function inject (key: string, injection: Function): void {\n        Object.defineProperty(injections, key, {\n            value: injection,\n            writable: false\n        })\n    }\n\n    function get (key: string, backup: Function): Function {\n        return injections[key] || backup\n    }\n\n    return {\n        inject,\n        get\n    }\n}\n","import { UserOptions, optionFormatter, Options } from './options'\nimport { EventHub } from './eventHub'\nimport { State } from './state/index'\nimport { Sensor } from './sensor/index'\nimport { Env } from './env/index'\nimport { Renderer } from './render/index'\nimport { Operations } from './state/operations'\nimport { Injections } from './injections'\n\nexport type SwiperInstance = {\n    on: (evtName: string, cb: Function) => void\n    off: (evtName: string, cb: Function) => void\n    update: () => void\n    destroy: () => void\n    slideTo: (index: number, duration: number) => void\n    options: Options\n    env: Env\n    state: State\n    updateSize: () => void\n    inject: (key: string, injection: Function) => void\n}\nexport type SwiperPlugin = (instance: SwiperInstance, options: Options) => void\n\nexport type Swiper = {\n    (el: HTMLElement | string, userOptions: UserOptions): SwiperInstance\n    use: (plugins: Array<SwiperPlugin>) => void\n    plugins: Array<SwiperPlugin>\n}\n\nconst Swiper: Swiper = <Swiper> function (\n    el: HTMLElement | string,\n    userOptions: UserOptions\n): SwiperInstance {\n    const options = optionFormatter(userOptions)\n    const eventHub = EventHub()\n    const env = Env(el, options)\n    const state = State()\n    const injections = Injections()\n    const {\n        on,\n        off,\n        emit\n    } = eventHub\n    const instance = {\n        on,\n        off,\n        env,\n        state,\n        options\n    } as SwiperInstance\n\n    (options.plugins || Swiper.plugins || [])\n        .forEach((plugin: SwiperPlugin) => plugin(\n            instance,\n            options\n        ))\n\n    emit('before-init', instance)\n\n    // Initialize internal module\n    const renderer = Renderer(\n        env,\n        options\n    )\n    const operations = Operations(\n        env,\n        state,\n        options,\n        renderer,\n        eventHub\n    )\n    const sensor = Sensor(\n        env,\n        state,\n        options,\n        operations,\n        injections\n    )\n\n    function destroy (): void {\n        sensor.detach()\n        renderer.destroy()\n        eventHub.clear()\n    }\n\n    function updateSize (): void {\n        env.update()\n        operations.update()\n    }\n\n    function update (): void {\n        renderer.destroy()\n        env.update()\n        renderer.init()\n\n        updateSize()\n    }\n\n    const {\n        slideTo\n    } = operations\n    const {\n        inject\n    } = injections\n\n    Object.assign(instance, {\n        update,\n        destroy,\n        slideTo,\n        updateSize,\n        inject\n    })\n\n    renderer.init()\n    sensor.attach()\n    operations.slideTo(\n        options.initialSlide,\n        0\n    )\n    emit('after-init', instance)\n\n    return instance\n}\n\nSwiper.use = (plugins: Array<SwiperPlugin>): void => {\n    Swiper.plugins = plugins\n}\n\nexport default Swiper\n"],"names":["defaultOptions","direction","touchRatio","touchAngle","longSwipesRatio","initialSlide","loop","freeMode","mousewheel","pagination","passiveListeners","resistance","resistanceRatio","speed","longSwipesMs","intermittent","spaceBetween","slidesPerView","centeredSlides","slidePrevClass","slideNextClass","slideActiveClass","slideClass","wrapperClass","touchStartPreventDefault","touchStartForcePreventDefault","touchMoveStopPropagation","excludeElements","optionFormatter","userOptions","options","isHorizontal","EventHub","hub","on","evtName","cb","push","off","index","indexOf","splice","emit","data","forEach","clear","delta","Math","PI","Vector","logs","trace","formerTrace","diff","x","y","duration","time","velocityX","velocityY","angle","atan2","abs","Tracker","position","Date","now","vector","length","getLogs","getDuration","first","last","getOffset","State","state","tracker","startTransform","isStart","isScrolling","isTouching","transforms","progress","addClass","el","list","Array","isArray","clz","classList","contains","add","removeClass","remove","attachListener","handler","opts","addEventListener","detachListener","removeEventListener","setAttr","attr","value","setAttribute","setStyle","style","forceRender","Object","keys","prop","getComputedStyle","getTranslate","matrix","transform","replace","split","map","parseFloat","arr","slice","performance","Tick","nextFrame","requestAnimationFrame","webkitRequestAnimationFrame","setTimeout","cancelNextFrame","cancelAnimationFrame","webkitCancelAnimationFrame","clearTimeout","startTime","id","run","timeStamp","interval","stop","undefined","Animation","tick","task","Motions","env","operations","initLayout","initStatus","render","scrollPixel","slideTo","getOffsetSteps","animation","preheat","originPosition","originTransform","move","displacement","offset","measure","trans","jump","ceil","boxSize","longSwipeIndex","velocity","Sensor","injections","touchable","formEls","motions","get","getPosition","e","touch","changedTouches","pageX","pageY","onTouchStart","$wrapper","element","shouldPreventDefault","target","nodeName","preventDefault","onTouchMove","stopPropagation","onTouchEnd","attach","$el","passive","capture","document","detach","Element","body","querySelector","$list","call","getElementsByClassName","Measure","viewSize","offsetWidth","offsetHeight","slideSize","getExpand","Limitation","expand","buffer","base","max","min","minIndex","maxIndex","limitation","Env","update","Boolean","window","navigator","maxTouchPoints","msMaxTouchPoints","DocumentTouch","assign","shallowTag","sliderTag","Renderer","force","wrapperStyle","transition","querySelectorAll","$slide","tagNumber","getAttribute","appendExpandList","$leftExpandList","cloneNode","$rightExpandList","$shadowSlide","appendChild","insertBefore","destroyExpandList","item","removeChild","updateDom","updateSize","display","willChange","flexDirection","itemStyle","init","destroy","itemProp","propertyName","removeProperty","isExceedingLimits","getExcess","exceedLeft","exceedRight","Operations","renderer","eventHub","transRange","len","targetIndex","computedIndex","excess","px","ratio","Number","toExponential","pow","newTransform","Injections","inject","key","injection","defineProperty","writable","backup","Swiper","instance","plugins","plugin","sensor","use"],"mappings":"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"}