{"version":3,"file":"keyboardControl.js","sources":["../../src/core/render/dom.ts","../../src/modules/keyboardControl.ts"],"sourcesContent":["export function addClass (\r\n    el: HTMLElement,\r\n    list: Array<string> | string = []\r\n): void {\r\n    if (!Array.isArray(list)) list = [list]\r\n\r\n    list.forEach(clz => (!el.classList.contains(clz) && el.classList.add(clz)))\r\n}\r\n\r\nexport function removeClass (\r\n    el: HTMLElement,\r\n    list: Array<string> | string = []\r\n): void {\r\n    if (!Array.isArray(list)) list = [list]\r\n\r\n    list.forEach(clz => (el.classList.contains(clz) && el.classList.remove(clz)))\r\n}\r\n\r\nexport function attachListener (\r\n    el: HTMLElement | Document | Window,\r\n    evtName: string,\r\n    handler: EventListenerOrEventListenerObject,\r\n    opts?: boolean | AddEventListenerOptions\r\n): void {\r\n    el.addEventListener(evtName, handler, opts)\r\n}\r\n\r\nexport function detachListener (\r\n    el: HTMLElement | Document | Window,\r\n    evtName: string,\r\n    handler: EventListenerOrEventListenerObject\r\n): void {\r\n    el.removeEventListener(evtName, handler)\r\n}\r\n\r\nexport function removeAttr (\r\n    el: HTMLElement,\r\n    attr: string\r\n): void {\r\n    el.removeAttribute(attr)\r\n}\r\n\r\nexport function setAttr (\r\n    el: HTMLElement,\r\n    attr: string,\r\n    value = ''\r\n): HTMLElement {\r\n    el.setAttribute(attr, value)\r\n    return el\r\n}\r\n\r\nexport function setStyle (\r\n    el: HTMLElement,\r\n    style: {[key: string]: string},\r\n    forceRender?: boolean\r\n): HTMLElement {\r\n    Object.keys(style).forEach(prop => {\r\n        // TS7015: Element implicitly has an 'any' type because index expression is not of type 'number'.\r\n        el.style[prop as any] = style[prop]\r\n    })\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-expressions\r\n    forceRender && getComputedStyle(el)\r\n\r\n    return el\r\n}\r\n\r\nexport function getTranslate (\r\n    el: HTMLElement,\r\n    isHorizontal: boolean\r\n): number {\r\n    const matrix = getComputedStyle(el).transform.replace(/[a-z]|\\(|\\)|\\s/g, '').split(',').map(parseFloat)\r\n    let arr: Array<number> = []\r\n\r\n    if (matrix.length === 16) {\r\n        arr = matrix.slice(12, 14)\r\n    } else if (matrix.length === 6) {\r\n        arr = matrix.slice(4, 6)\r\n    }\r\n    return (<Array<number>>arr)[isHorizontal ? 0 : 1] || 0\r\n}\r\n","import {\r\n    attachListener,\r\n    detachListener\r\n} from '../core/render/dom'\r\nimport { SwiperInstance } from '../core/index'\r\nimport { Options } from '../core/options'\r\n\r\nexport type SwiperPluginKeyboardControlOptions = {\r\n    enabled: boolean\r\n    onlyInViewport: boolean\r\n}\r\n\r\nconst DIRECTION = {\r\n    up: 'ArrowUp',\r\n    right: 'ArrowRight',\r\n    down: 'ArrowDown',\r\n    left: 'ArrowLeft'\r\n}\r\n\r\nfunction isVisible (el: HTMLElement): boolean {\r\n    if (!el) return false\r\n\r\n    const style = getComputedStyle(el)\r\n    const visible = style.visibility !== 'hidden' && style.display !== 'none'\r\n\r\n    if (!visible) return false\r\n\r\n    return el.parentElement && el.parentElement.nodeType === 1\r\n        ? isVisible(el.parentElement)\r\n        : true\r\n}\r\n\r\nfunction isElementInView (el: HTMLElement): boolean {\r\n    const visibility = isVisible(el)\r\n    const boundary = el.getBoundingClientRect()\r\n    const isInView = (boundary.top >= 0 && boundary.bottom <= window.innerHeight)\r\n        && (boundary.left >= 0 && boundary.right <= window.innerWidth)\r\n\r\n    return isInView && visibility\r\n}\r\n\r\n/**\r\n * TinySwiper plugin for keyboard control.\r\n *\r\n * @param {SwiperInstance} instance\r\n * @param {Options}\r\n */\r\nexport default function SwiperPluginKeyboardControl (\r\n    instance: SwiperInstance & {\r\n        keyboard: {\r\n            onKeyDown (e: Event): void\r\n            enable (): void\r\n            disable (): void\r\n        }\r\n    },\r\n    options: Options\r\n): void {\r\n    if (!options.keyboard) return\r\n\r\n    const keyboardOptions = <SwiperPluginKeyboardControlOptions>options.keyboard\r\n    const keyboard = {\r\n        enable (): void {\r\n            keyboardOptions.enabled = true\r\n        },\r\n        disable (): void {\r\n            keyboardOptions.enabled = false\r\n        },\r\n        onKeyDown (e: KeyboardEvent): void {\r\n            const { key } = e\r\n\r\n            if ((keyboardOptions.onlyInViewport && !isElementInView(instance.env.element.$el))\r\n                || !keyboardOptions.enabled) return\r\n\r\n            if (options.isHorizontal) {\r\n                if (key === DIRECTION.left) {\r\n                    instance.slideTo(instance.state.index - 1)\r\n                } else if (key === DIRECTION.right) {\r\n                    instance.slideTo(instance.state.index + 1)\r\n                }\r\n            } else {\r\n                if (key === DIRECTION.down) {\r\n                    instance.slideTo(instance.state.index - 1)\r\n                } else if (key === DIRECTION.up) {\r\n                    instance.slideTo(instance.state.index + 1)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    instance.on('before-init', () => {\r\n        options.keyboard = {\r\n            enabled: true,\r\n            onlyInViewport: true,\r\n            ...options.keyboard\r\n        }\r\n\r\n        instance.keyboard = keyboard\r\n\r\n        attachListener(window, 'keydown', keyboard.onKeyDown as EventListener)\r\n    })\r\n\r\n    instance.on('after-destroy', () => {\r\n        if (!keyboard) return\r\n\r\n        detachListener(window, 'keydown', keyboard.onKeyDown as EventListener)\r\n\r\n        delete instance.keyboard\r\n    })\r\n}\r\n"],"names":["attachListener","el","evtName","handler","opts","addEventListener","detachListener","removeEventListener","DIRECTION","up","right","down","left","isVisible","style","getComputedStyle","visible","visibility","display","parentElement","nodeType","isElementInView","boundary","getBoundingClientRect","isInView","top","bottom","window","innerHeight","innerWidth","SwiperPluginKeyboardControl","instance","options","keyboard","keyboardOptions","enable","enabled","disable","onKeyDown","e","key","onlyInViewport","env","element","$el","isHorizontal","slideTo","state","index","on"],"mappings":"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"}