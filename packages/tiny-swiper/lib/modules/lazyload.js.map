{"version":3,"file":"lazyload.js","sources":["../../src/core/render/dom.ts","../../src/modules/lazyload.ts"],"sourcesContent":["export function addClass (\n    el: HTMLElement,\n    list: Array<string> | string = []\n): void {\n    if (!Array.isArray(list)) list = [list]\n\n    list.forEach(clz => (!el.classList.contains(clz) && el.classList.add(clz)))\n}\n\nexport function removeClass (\n    el: HTMLElement,\n    list: Array<string> | string = []\n): void {\n    if (!Array.isArray(list)) list = [list]\n\n    list.forEach(clz => (el.classList.contains(clz) && el.classList.remove(clz)))\n}\n\nexport function attachListener (\n    el: HTMLElement | Document | Window,\n    evtName: string,\n    handler: EventListenerOrEventListenerObject,\n    opts?: boolean | AddEventListenerOptions\n): void {\n    el.addEventListener(evtName, handler, opts)\n}\n\nexport function detachListener (\n    el: HTMLElement | Document | Window,\n    evtName: string,\n    handler: EventListenerOrEventListenerObject\n): void {\n    el.removeEventListener(evtName, handler)\n}\n\nexport function removeAttr (\n    el: HTMLElement,\n    attr: string\n): void {\n    el.removeAttribute(attr)\n}\n\nexport function setAttr (\n    el: HTMLElement,\n    attr: string,\n    value = ''\n): HTMLElement {\n    el.setAttribute(attr, value)\n    return el\n}\n\nexport function setStyle (\n    el: HTMLElement,\n    style: {[key: string]: string},\n    forceRender?: boolean\n): HTMLElement {\n    Object.keys(style).forEach(prop => {\n        // TS7015: Element implicitly has an 'any' type because index expression is not of type 'number'.\n        el.style[prop as any] = style[prop]\n    })\n    // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n    forceRender && getComputedStyle(el)\n\n    return el\n}\n\nexport function getTranslate (\n    el: HTMLElement,\n    isHorizontal: boolean\n): number {\n    const matrix = getComputedStyle(el).transform.replace(/[a-z]|\\(|\\)|\\s/g, '').split(',').map(parseFloat)\n    let arr: Array<number> = []\n\n    if (matrix.length === 16) {\n        arr = matrix.slice(12, 14)\n    } else if (matrix.length === 6) {\n        arr = matrix.slice(4, 6)\n    }\n    return (<Array<number>>arr)[isHorizontal ? 0 : 1] || 0\n}\n","import {\n    addClass,\n    removeClass\n} from '../core/render/dom'\nimport { SwiperInstance } from '../core/index'\nimport { Options } from '../core/options'\nimport { State } from '../core/state/index'\n\ndeclare type SwiperPluginLazyloadOptions = Options & {\n    lazyload: {\n        loadPrevNext: false\n        loadPrevNextAmount: 1\n        loadOnTransitionStart: false\n        elementClass: 'swiper-lazy'\n        loadingClass: 'swiper-lazy-loading'\n        loadedClass: 'swiper-lazy-loaded'\n        preloaderClass: 'swiper-lazy-preloader'\n    }\n}\n\ndeclare type SwiperPluginLazyloadHTMLElement = HTMLImageElement & {\n    isLoaded: boolean\n}\n\n/**\n * TinySwiper plugin for image lazy loading.\n *\n * @param {SwiperInstance} instance\n * @param {Options}\n */\nexport default function SwiperPluginLazyload (\n    instance: SwiperInstance & {\n        lazyload: {\n            load (index: number): void\n            loadRange (\n                index: number,\n                range: number\n            ): void\n        }\n    },\n    options: SwiperPluginLazyloadOptions\n) {\n    if (!options.lazyload) return\n\n    const lazyload = {\n        load (index: number): void {\n            const $slide = instance.env.element.$list[index]\n\n            if (!$slide) return\n\n            const $imgs = [].slice.call($slide.getElementsByClassName(options.lazyload.elementClass))\n            const $preloaders: HTMLElement[] = [].slice.call($slide.getElementsByClassName(options.lazyload.preloaderClass))\n\n            function handleLoaded ($img: SwiperPluginLazyloadHTMLElement) {\n                $img.removeAttribute('data-src')\n                addClass($img, [options.lazyload.loadedClass])\n                removeClass($img, [options.lazyload.loadingClass])\n                $img.onload = null\n                $img.onerror = null\n                $img.isLoaded = true\n\n                if ($imgs.every((item: SwiperPluginLazyloadHTMLElement) => item.isLoaded)) {\n                    $preloaders.forEach(($preloader: HTMLElement) => {\n                        $preloader.parentElement!.removeChild($preloader)\n                    })\n                }\n            }\n\n            $imgs.forEach(($img: SwiperPluginLazyloadHTMLElement) => {\n                if (!$img.hasAttribute('data-src')) return\n\n                const src = $img.getAttribute('data-src')\n\n                addClass($img, [options.lazyload.loadingClass])\n                removeClass($img, [options.lazyload.loadedClass])\n                $img.src = src as string\n                $img.onload = () => handleLoaded($img)\n                $img.onerror = () => handleLoaded($img)\n            })\n        },\n\n        loadRange (\n            index: number,\n            range: number\n        ): void {\n            lazyload.load(index)\n\n            if (options.lazyload.loadPrevNext && range >= 1) {\n                for (let i = 1; i <= range; i++) {\n                    lazyload.load(index + i)\n                    lazyload.load(index - i)\n                }\n            }\n        }\n    }\n\n    instance.on('before-init', () => {\n        options.lazyload = {\n            loadPrevNext: false,\n            loadPrevNextAmount: 1,\n            loadOnTransitionStart: false,\n            elementClass: 'swiper-lazy',\n            loadingClass: 'swiper-lazy-loading',\n            loadedClass: 'swiper-lazy-loaded',\n            preloaderClass: 'swiper-lazy-preloader',\n            ...options.lazyload\n        }\n    })\n\n    if (options.lazyload.loadOnTransitionStart) {\n        instance.on('before-slide', (\n            oldIndex: number,\n            state: State,\n            newIndex: number\n        ) => {\n            lazyload.loadRange(newIndex, options.lazyload.loadPrevNextAmount)\n        })\n    } else {\n        instance.on('after-slide', (\n            index: number,\n            state: State\n        ) => {\n            lazyload.loadRange(index, options.lazyload.loadPrevNextAmount)\n        })\n    }\n\n    instance.on('after-destroy', () => {\n        if (!instance.lazyload) return\n\n        delete instance.lazyload\n    })\n}\n"],"names":["addClass","el","list","Array","isArray","forEach","clz","classList","contains","add","removeClass","remove","SwiperPluginLazyload","instance","options","lazyload","load","index","$slide","env","element","$list","$imgs","slice","call","getElementsByClassName","elementClass","$preloaders","preloaderClass","handleLoaded","$img","removeAttribute","loadedClass","loadingClass","onload","onerror","isLoaded","every","item","$preloader","parentElement","removeChild","hasAttribute","src","getAttribute","loadRange","range","loadPrevNext","i","on","loadPrevNextAmount","loadOnTransitionStart","oldIndex","state","newIndex"],"mappings":"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"}