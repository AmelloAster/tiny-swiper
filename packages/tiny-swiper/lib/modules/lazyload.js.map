{"version":3,"file":"lazyload.js","sources":["../../src/core/render/dom.ts","../../src/modules/lazyload.ts"],"sourcesContent":["export function addClass (\r\n    el: HTMLElement,\r\n    list: Array<string> | string = []\r\n): void {\r\n    if (!Array.isArray(list)) list = [list]\r\n\r\n    list.forEach(clz => (!el.classList.contains(clz) && el.classList.add(clz)))\r\n}\r\n\r\nexport function removeClass (\r\n    el: HTMLElement,\r\n    list: Array<string> | string = []\r\n): void {\r\n    if (!Array.isArray(list)) list = [list]\r\n\r\n    list.forEach(clz => (el.classList.contains(clz) && el.classList.remove(clz)))\r\n}\r\n\r\nexport function attachListener (\r\n    el: HTMLElement | Document | Window,\r\n    evtName: string,\r\n    handler: EventListenerOrEventListenerObject,\r\n    opts?: boolean | AddEventListenerOptions\r\n): void {\r\n    el.addEventListener(evtName, handler, opts)\r\n}\r\n\r\nexport function detachListener (\r\n    el: HTMLElement | Document | Window,\r\n    evtName: string,\r\n    handler: EventListenerOrEventListenerObject\r\n): void {\r\n    el.removeEventListener(evtName, handler)\r\n}\r\n\r\nexport function removeAttr (\r\n    el: HTMLElement,\r\n    attr: string\r\n): void {\r\n    el.removeAttribute(attr)\r\n}\r\n\r\nexport function setAttr (\r\n    el: HTMLElement,\r\n    attr: string,\r\n    value = ''\r\n): HTMLElement {\r\n    el.setAttribute(attr, value)\r\n    return el\r\n}\r\n\r\nexport function setStyle (\r\n    el: HTMLElement,\r\n    style: {[key: string]: string},\r\n    forceRender?: boolean\r\n): HTMLElement {\r\n    Object.keys(style).forEach(prop => {\r\n        // TS7015: Element implicitly has an 'any' type because index expression is not of type 'number'.\r\n        el.style[prop as any] = style[prop]\r\n    })\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-expressions\r\n    forceRender && getComputedStyle(el)\r\n\r\n    return el\r\n}\r\n\r\nexport function getTranslate (\r\n    el: HTMLElement,\r\n    isHorizontal: boolean\r\n): number {\r\n    const matrix = getComputedStyle(el).transform.replace(/[a-z]|\\(|\\)|\\s/g, '').split(',').map(parseFloat)\r\n    let arr: Array<number> = []\r\n\r\n    if (matrix.length === 16) {\r\n        arr = matrix.slice(12, 14)\r\n    } else if (matrix.length === 6) {\r\n        arr = matrix.slice(4, 6)\r\n    }\r\n    return (<Array<number>>arr)[isHorizontal ? 0 : 1] || 0\r\n}\r\n","import {\r\n    addClass,\r\n    removeClass\r\n} from '../core/render/dom'\r\nimport { SwiperInstance } from '../core/index'\r\nimport { Options } from '../core/options'\r\nimport { State } from '../core/state/index'\r\n\r\nexport type SwiperPluginLazyloadOptions = {\r\n    loadPrevNext: false\r\n    loadPrevNextAmount: 1\r\n    loadOnTransitionStart: false\r\n    elementClass: 'swiper-lazy'\r\n    loadingClass: 'swiper-lazy-loading'\r\n    loadedClass: 'swiper-lazy-loaded'\r\n    preloaderClass: 'swiper-lazy-preloader'\r\n}\r\n\r\nexport type SwiperPluginLazyloadHTMLElement = HTMLImageElement & {\r\n    isLoaded: boolean\r\n}\r\n\r\n/**\r\n * TinySwiper plugin for image lazy loading.\r\n *\r\n * @param {SwiperInstance} instance\r\n * @param {Options}\r\n */\r\nexport default function SwiperPluginLazyload (\r\n    instance: SwiperInstance & {\r\n        lazyload: {\r\n            load (index: number): void\r\n            loadRange (\r\n                index: number,\r\n                range: number\r\n            ): void\r\n        }\r\n    },\r\n    options: Options\r\n) {\r\n    if (!options.lazyload) return\r\n\r\n    const lazyloadOptions = <SwiperPluginLazyloadOptions>options.lazyload\r\n    const lazyload = {\r\n        load (index: number): void {\r\n            const $slide = instance.env.element.$list[index]\r\n\r\n            if (!$slide) return\r\n\r\n            const $imgs = [].slice.call($slide.getElementsByClassName(lazyloadOptions.elementClass))\r\n            const $preloaders: HTMLElement[] = [].slice.call($slide.getElementsByClassName(lazyloadOptions.preloaderClass))\r\n\r\n            function handleLoaded ($img: SwiperPluginLazyloadHTMLElement) {\r\n                $img.removeAttribute('data-src')\r\n                addClass($img, [lazyloadOptions.loadedClass])\r\n                removeClass($img, [lazyloadOptions.loadingClass])\r\n                $img.onload = null\r\n                $img.onerror = null\r\n                $img.isLoaded = true\r\n\r\n                if ($imgs.every((item: SwiperPluginLazyloadHTMLElement) => item.isLoaded)) {\r\n                    $preloaders.forEach(($preloader: HTMLElement) => {\r\n                        $preloader.parentElement!.removeChild($preloader)\r\n                    })\r\n                }\r\n            }\r\n\r\n            $imgs.forEach(($img: SwiperPluginLazyloadHTMLElement) => {\r\n                if (!$img.hasAttribute('data-src')) return\r\n\r\n                const src = $img.getAttribute('data-src')\r\n\r\n                addClass($img, [lazyloadOptions.loadingClass])\r\n                removeClass($img, [lazyloadOptions.loadedClass])\r\n                $img.src = src as string\r\n                $img.onload = () => handleLoaded($img)\r\n                $img.onerror = () => handleLoaded($img)\r\n            })\r\n        },\r\n\r\n        loadRange (\r\n            index: number,\r\n            range: number\r\n        ): void {\r\n            lazyload.load(index)\r\n\r\n            if (lazyloadOptions.loadPrevNext && range >= 1) {\r\n                for (let i = 1; i <= range; i++) {\r\n                    lazyload.load(index + i)\r\n                    lazyload.load(index - i)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    instance.on('before-init', () => {\r\n        options.lazyload = {\r\n            loadPrevNext: false,\r\n            loadPrevNextAmount: 1,\r\n            loadOnTransitionStart: false,\r\n            elementClass: 'swiper-lazy',\r\n            loadingClass: 'swiper-lazy-loading',\r\n            loadedClass: 'swiper-lazy-loaded',\r\n            preloaderClass: 'swiper-lazy-preloader',\r\n            ...options.lazyload\r\n        }\r\n    })\r\n\r\n    if (lazyloadOptions.loadOnTransitionStart) {\r\n        instance.on('before-slide', (\r\n            oldIndex: number,\r\n            state: State,\r\n            newIndex: number\r\n        ) => {\r\n            lazyload.loadRange(newIndex, lazyloadOptions.loadPrevNextAmount)\r\n        })\r\n    } else {\r\n        instance.on('after-slide', (\r\n            index: number\r\n        ) => {\r\n            lazyload.loadRange(index, lazyloadOptions.loadPrevNextAmount)\r\n        })\r\n    }\r\n\r\n    instance.on('after-destroy', () => {\r\n        if (!instance.lazyload) return\r\n\r\n        delete instance.lazyload\r\n    })\r\n}\r\n"],"names":["addClass","el","list","Array","isArray","forEach","clz","classList","contains","add","removeClass","remove","SwiperPluginLazyload","instance","options","lazyload","lazyloadOptions","load","index","$slide","env","element","$list","$imgs","slice","call","getElementsByClassName","elementClass","$preloaders","preloaderClass","handleLoaded","$img","removeAttribute","loadedClass","loadingClass","onload","onerror","isLoaded","every","item","$preloader","parentElement","removeChild","hasAttribute","src","getAttribute","loadRange","range","loadPrevNext","i","on","loadPrevNextAmount","loadOnTransitionStart","oldIndex","state","newIndex"],"mappings":"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"}